\documentclass[11pt,a4paper]{article}

\usepackage{geometry}
 \geometry{
 a4paper,
 total={150mm,237mm},
 left=30mm,
 top=30mm,
 }

% cf. http://tex.stackexchange.com/questions/50182/subtitle-with-the-maketitle-page
\usepackage{titling}
\newcommand{\subtitle}[1]{%
  \posttitle{%
    \par\end{center}
    \begin{center}\large\textbf{#1}\end{center}
    \vskip0.5em}%
}

\usepackage{color}
\usepackage{graphicx}
\usepackage{subcaption}

\usepackage[utf8]{inputenc}
\usepackage[lf]{venturis} %% lf option gives lining figures as default; 
\usepackage[T1]{fontenc}
\usepackage{beramono}
\usepackage{csquotes}
\usepackage[UKenglish,german]{babel}

\usepackage{fancyvrb}

\widowpenalty10000  % http://tex.stackexchange.com/questions/4152/how-do-i-prevent-widow-orphan-lines
\clubpenalty10000

\title{The SysSon Platform}
\subtitle{Technical Report TR-2016-11-1\\Institute of Electronic Music and Acoustics, Graz\\(Status: in progress)}
\author{Hanns Holger Rutz}
% \date{09-Feb-2016}
\date{November 2016}

% cf. https://tex.stackexchange.com/questions/94126/change-font-to-only-section-and-subsection-of-my-document
%\usepackage{titlesec}
%\titleformat{\chapter}[display]
%  {\fontfamily{pag}\selectfont\huge\bfseries}
%  {\chaptertitlename\ \thechapter}
%  {20pt}
%  {\Huge}
%\titleformat{\section}
%  {\fontfamily{pag}\selectfont\bfseries\Large}
%  {\thesection}
%  {1em}
%  {}
%\titleformat{\subsection}
%  {\fontfamily{pag}\selectfont\bfseries\Large}
%  {\thesection}
%  {1em}
%  {}

\usepackage[backend=biber,authordate]{biblatex-chicago} % citereset=chapter
%\usepackage[backend=biber,natbib,isbn=false,useprefix=true,sorting=ydnt]{biblatex-chicago} % citereset=chapter
\addbibresource{all.bib} % add a bib-reference file
\addbibresource{rutz.bib} % add a bib-reference file

% warning: https://tex.stackexchange.com/questions/313477/
% \usepackage{csquotes}

\usepackage{tabularx}
% cf. https://tex.stackexchange.com/questions/84400/table-layout-with-tabularx-column-widths-502525
\newcolumntype{s}{>{\hsize=1cm}X}

% says you should load after babel and fontspec
\usepackage[shrink=10, babel=true]{microtype}	% http://tex.stackexchange.com/questions/141852/latex-allows-line-break-between-concluding-em-dash-and-comma-before-a-new-sub-cl/141854#141854

% has to come first for full scale TeX voodoo bullcrap
\usepackage{hyperref}
% get rid of the horrible coloured boxes around links
\hypersetup{
    colorlinks,%
    citecolor=black,%
    filecolor=black,%
    linkcolor=black,%
    urlcolor=black
}
% has to come after frickin hyperref
\VerbatimFootnotes

\newcommand{\todo}[1]{\colorbox{yellow}{\textsc{todo}: #1}}

\newcommand{\quot}[1]{\guillemotleft {#1}\guillemotright}

\newcommand{\worktitle}[1]{\textit{#1}}

\newcommand{\workentry}[2]{\vspace{7.5pt}\noindent\textbf{#1} (#2)}
\newcommand{\workentrySel}[2]{\vspace{7.5pt}\noindent\textbf{#1}$*$ (#2)}

\newcommand{\figref}[1]{Fig.~\ref{#1}}

\newcommand{\software}[1]{\textit{#1}}

\newcommand{\sysson}[0]{SysSon}
\newcommand{\syssonVersion}[0]{1.8.0}
\newcommand{\syssonVersionS}[0]{1.8.0-SNAPSHOT}

\newcommand{\artefacts}[0]{\textsc{Artefacts:}}
\newcommand{\assessment}[0]{\textsc{Assessment:}}

\usepackage{listings}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstdefinestyle{plain}{
  frame=tb,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=true,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  frame=none,
  keepspaces=true,
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3,
}

\lstdefinestyle{scala}{
  frame=tb,
  language=scala,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=true,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  frame=none,
  keepspaces=true,
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3,
}

\lstdefinestyle{scala-small}{
  frame=tb,
  language=scala,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=true,
  columns=flexible,
  basicstyle={\tiny\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  frame=none,
  keepspaces=true,
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3,
}

\begin{document}
% \begin{titlepage}
\maketitle
\selectlanguage{UKenglish}
\thispagestyle{empty}
\newpage
\section{QBO - Blob Sonification}

After some initial experiments with frequency modulation to indicate blob slice height, it was decided to try out other forms of timbre modification such as wave-shaping. SuperCollider provides wave-shaping by means of the \Verb!Shaper! UGen, typically with a buffer prepared with Chebychev polynomial functions. However, it seems not possible to continuously fade in a particular timbre by altering the input signal's amplitude, as different lower partials will transitorily be attenuated. Another possibility is through the \Verb!VOsc! variable table oscillator. In order to generate the appropriate wave-tables, a graph element \Verb!BufferGen! has been added to \software{Sound\,Processes}. As \Verb!VOsc! depends on a trick of allocating multiple buffers with consecutive identifiers, and this consecutiveness is currently not possible to guarantee in \software{Sound\,Processes}, one can simply mix and blend multiple \Verb!Osc! instances manually, which has the same effect. The code is shown in \figref{fig:wave-shaping-mk-osc}, where the \Verb!amp! parameter is expected to be in the range from zero to one, and it scans through the different spectra.

\begin{figure}[b]
\begin{lstlisting}[style=scala]
def mkOsc(freq: GE, amt: GE): GE = {
  val oddBase  = 1f
  val evenBase = 0f
  val oddDamp  = 0.7f
  val evenDamp = 0.8f
  val numHarm  = 9
  val numBufs  = 5
  val tableSz  = 1024
  
  val oscs = (0 until numBufs).map { i =>
    val amps0 = Seq.tabulate(numHarm) { j =>
      val isEven = (j + 1).isEven
      val base   = if (isEven) evenBase else oddBase
      val damp   = if (isEven) evenDamp else oddDamp
      val exp    = (j / 2) * (numBufs - i)
      base * damp.pow(exp)
    }
    // first is forced to be fundamental only
    val amps = if (i == 0) Seq(1f) else amps0
    val buf = BufferGen.sine1(amps, numFrames = tableSz)
    Osc.ar(buf, freq)
  }
  
  val idx  = amt.linlin(0, 1, 0, numBufs - 1)
  val idxF = idx.floor
  val idxC = idx.ceil
  val wC   = idx % 1.0
  val wF   = 1.0 - wC
  
  val osc  = Select.ar(idxF, oscs) * wF + Select.ar(idxC, oscs) * wC
  osc
}
\end{lstlisting}
\caption{Generation of oscillator mix implementing blending of partial frequencies.}
\label{fig:wave-shaping-mk-osc}
\end{figure}

\figref{fig:blob-shaper-161102-sono} shows the sonogram of a bounce of this sonification model with the QBO blob data. The bounce can be heard at \url{https://soundcloud.com/syssonproject/blob-shaper161102}. The parameters are:
%
\begin{itemize}
\item time = 2002-01-16 12:00:00Z to 2016-02-15 12:00:00Z
\item lon = 75.00 °W; lat = 2.50 °S
\item speed = 6 months/sec, mag-max = 3, min-freq = 300 Hz, max-freq  = 800 Hz
\item spread-mod-depth = 1.5, spread-mod-offset = 0.3
\end{itemize}

\begin{figure}
\includegraphics[width=\textwidth]{figures/blob-shaper161102.png}
\caption{Sonogram of QBO sonification with blob slice height mapped to overtone spectrum}
\label{fig:blob-shaper-161102-sono}
\end{figure}
%

\subsection{``Importing'' Timbres From a GA Process}

We have been recently experimenting with the algorithmic production of sound synthesis structures, by using genetic programming of synth graphs based on a target sound and a fitness function that correlates the spectra and loudness contours of target sound and individuals in the GP populations. While this does not yield sounds close to the target sound in reasonable time and number of iterations, it has proven to be a very useful generator of interesting timbres.

Therefore, it seems useful to try and ``import'' timbres produced in this evolutionary algorithm to SysSon. There is a simple source code generator for the found sound structures, and the work is then to select a sound, unclutter the source code from ``dead'' branches (e.g. those that essentially produce silence or components that one wants to remove from the timbre), and finally identify parameters that one wants to control (e.g. fundamental frequency). The GP comes up with interesting solutions for modulating timbre, such as adding signals and then clipping the sum, producing thus co-modulations.

\figref{fig:code-shaper-timbre2} shows the result of such an imported sound, with the sonogram for applying it in the usual QBO setup shown in \figref{fig:sono-shaper-timbre2}. A bounce of this sound can be found at \url{https://soundcloud.com/syssonproject/blob-shaper-timbre2-161107}.

\begin{figure}[b]
\begin{lstlisting}[style=scala]

// ---- oscillator ----

def mkOsc1(freq: GE): GE = SinOsc.ar(freq) * 0.75

def mkOsc2(freq: GE): GE = {
  val freq_4          = freq
  
  val amt_1           = 0.1
  val off_1           = 0.7
  val amt_2           = 1.0
  val freq_3          = 0.6 // adds irregularity
  val freq_5          = (freq_4 * 2).min(18000) // lpf
  
  val lFCub_0         = LFCub.ar(freq = freq_3, iphase = 0.660289)
  val min_7           = lFCub_0.min(0.0)
  val lFDNoise0       = LFDNoise0.ar(freq_3) + off_1
  val gbmanL          = GbmanL.ar(freq = freq_4, xi = 383.95047, yi = 383.95047)
  val min_33          = gbmanL min 0.36345935
  val blip            = Blip.ar(freq = freq_4, numHarm = 1.0)
  val plus            = blip + 0.1321
  val mix             = Mix(Seq[GE](
      lFDNoise0 * amt_1, 
      min_7 * amt_2, 
      min_33, 
      plus
  ))
  val sig0 = LeakDC.ar(mix.clip2(1)) * 0.75
  val sig  = LPF.ar(sig0, freq_5)
  sig
}

def mkOsc(freq: GE, amt: GE): GE = {
  val numOscs = 2
  val oscs = Seq(mkOsc1(freq), mkOsc2(freq))
  
  val idx  = amt.linlin(0, 1, 0, numOscs - 1)
  val idxF = idx.floor
  val idxC = idx.ceil
  val wC   = idx % 1.0
  val wF   = 1.0 - wC
  
  val osc  = Select.ar(idxF, oscs) * wF + Select.ar(idxC, oscs) * wC
  osc
}
\end{lstlisting}
\caption{Oscillator mix by fading between sine and complex timbre.}
\label{fig:code-shaper-timbre2}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{figures/blob-shaper-timbre2-161106.png}
\caption{Sonogram of QBO sonification with fading between sine and complex timbre.}
\label{fig:sono-shaper-timbre2}
\end{figure}

\todo{continue here}

% \printbibliography

\end{document}